@if (!isLoading()) {
  <div class="stats">
    <span>{{ 'flashcards.due-cards' | translate }} {{ dueCards().length }}</span>
    <span>{{ 'flashcards.total-cards' | translate }} {{ allCards().length }}</span>
    @if (currentCollection()) {
      <div class="current-collection-container">
        <app-star-button
          [starred]="currentCollection()!.starred"
          (toggle)="toggleStarred(currentCollection()!)"
        />
        <span class="current-array">{{ currentCollection()!.name }}</span>
      </div>
    }
  </div>
}
@if (isLoading()) {
  <div class="loading">
    <p>{{ 'flashcards.loading-cards' | translate }}</p>
  </div>
} @else if (!currentCard()) {
  <div class="no-cards">
    <h2>{{ 'flashcards.no-cards.title' | translate }}</h2>
    <p>{{ 'flashcards.no-cards.message' | translate }}</p>
  </div>
} @else {
  <div class="study-area">
    <div class="flashcard" [class.revealed]="currentCard().isRevealed">
      <div class="title-bar">
        <h3>{{ currentCard().front }}</h3>
        <div class="history-button">
          <app-button
            [size]="ButtonSize.SMALL"
            [icon]="assetUrlService.getHistoryIconUrl()"
            [title]="'flashcards.rating-history.show' | translate"
            (click)="toggleRatingHistory()"
          ></app-button>
        </div>
      </div>
      @if (!currentCard().isRevealed) {
        <button type="button" (click)="revealCard()"
                class="btn btn-secondary reveal-button">{{ 'flashcards.card.show-answer' | translate }}
        </button>
      } @else {
        <div class="card-back">
          <p>{{ 'flashcards.card.answer' | translate }}</p>
          <div class="card-text-with-speaker">
            <h3>{{ currentCard().back }}</h3>
            <button type="button" (click)="speakText(currentCard().back)" class="btn-speaker" aria-label="Speak">
              üîä
            </button>
            <button type="button" (click)="speakTextSlow(currentCard().back)" class="btn-speaker btn-speaker-slow"
                    aria-label="Speak slowly">
              üêå
            </button>
          </div>

          <div class="card-stats">
            <small>{{ getCardStats(currentCard()) }}</small>
          </div>

          <div class="rating-buttons">
            @if (getSchedulingPreview(); as preview) {
              <button type="button" (click)="rateCard(1)" class="btn btn-rating btn-again">
                <span class="rating-label">{{ 'flashcards.card.rating.again' | translate }}</span>
                <span class="rating-time">{{ formatTimeUntil(preview.again) }}</span>
              </button>
              <button type="button" (click)="rateCard(2)" class="btn btn-rating btn-hard">
                <span class="rating-label">{{ 'flashcards.card.rating.hard' | translate }}</span>
                <span class="rating-time">{{ formatTimeUntil(preview.hard) }}</span>
              </button>
              <button type="button" (click)="rateCard(3)" class="btn btn-rating btn-good">
                <span class="rating-label">{{ 'flashcards.card.rating.good' | translate }}</span>
                <span class="rating-time">{{ formatTimeUntil(preview.good) }}</span>
              </button>
              <button type="button" (click)="rateCard(4)" class="btn btn-rating btn-easy">
                <span class="rating-label">{{ 'flashcards.card.rating.easy' | translate }}</span>
                <span class="rating-time">{{ formatTimeUntil(preview.easy) }}</span>
              </button>
            }
          </div>
        </div>
      }
    </div>
  </div>
}
@if (!isLoading()) {
  @if (showAddForm()) {
    <div class="add-card-form">
      <h3>{{ 'flashcards.card.add-card' | translate }}</h3>
      <form [formGroup]="cardForm" (ngSubmit)="addCard()">
        <div class="form-group">
          <label for="front">{{ 'flashcards.card.front' | translate }}</label>
          <textarea
            id="front"
            formControlName="front"
            [placeholder]="'flashcards.card.front-input-placeholder' | translate "
            rows="3"
          >
      </textarea>
        </div>

        <div class="form-group">
          <label for="back">{{ 'flashcards.card.back' | translate }}</label>
          <textarea id="back" formControlName="back"
                    [placeholder]="'flashcards.card.back-input-placeholder' | translate" rows="3">
      </textarea>
        </div>

        <!--      add a dropdown to select a collection-->
        <div class="form-group">
          <label for="collection">{{ 'flashcards.card.select-collection' | translate }}</label>
          <select id="collection" formControlName="collection" class="form-control">
            @for (collection of selectedCollectionMetadata(); track collection.id) {
              <option [value]="collection.id">
                {{ collection.name }}
              </option>
            }
          </select>
        </div>

        <div class="form-actions">
          <button type="submit" [disabled]="cardForm.invalid"
                  class="btn btn-primary">{{ 'flashcards.card.confirm-add-card' | translate }}
          </button>
          <button type="button" (click)="addCardAndNew()" [disabled]="cardForm.invalid"
                  class="btn btn-primary">{{ 'flashcards.card.save-and-add-new' | translate }}
          </button>
          <button type="button" (click)="cancelAddCard()" class="btn btn-secondary">{{ 'common.cancel' | translate }}
          </button>
        </div>

      </form>
    </div>
  } @else {
    <div class="controls">
      <button type="button" (click)="showAddCardForm()" class="btn btn-outline">{{
          'flashcards.card.confirm-add-card' | translate
        }}
      </button>
      <button type="button" (click)="resetAllCards()" class="btn btn-outline btn-danger">
        {{ 'flashcards.card.reset-cards' | translate }}
      </button>
    </div>
  }
}

@if (showRatingHistory() && currentCard()) {
  <app-rating-history
    [ratingHistory]="currentCard()!.ratingHistory || []"
    (close)="closeRatingHistory()"
  ></app-rating-history>
}

